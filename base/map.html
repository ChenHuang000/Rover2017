<!DOCTYPE html>
<html style="height: 90%; width: 100%;">
    <head>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
        <script src="https://unpkg.com/pouchdb@^5.2.0/dist/pouchdb.js"></script>
        <script src="https://unpkg.com/leaflet.tilelayer.pouchdbcached@latest/L.TileLayer.PouchDBCached.js"></script>
        <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
        <script src="leaflet.rotatedMarker.js"></script>

    </head>

    <body style="height: 100%; width: 100%;">
        <div id="mapid" style="height: 100%; width: 100%"></div>

        <script id="script1">

            var lat = 38.4063;
            var long = -110.792286;
            var clickPopup = L.popup();
            var map = L.map('mapid').setView([lat, long], 17);
            var _wayPointNumber = 0;
            function getWayPointNumber() {
                if (!document.getElementById("_wayPointName").value)
                    return _wayPointNumber;
                else
                    return document.getElementById("_wayPointName").value;
            }
            L.tileLayer.wms(
                "https://services.nationalmap.gov/arcgis/services/USGSImageOnlyLarge/MapServer/WMSServer?",
                {
                    layers: "0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32",
                    useCache: true,
                    crossOrigin: true,
                    useOnlyCache: true
                }
            ).addTo(map);


            L.control.scale().addTo(map);
            var webChannel = new QWebChannel(qt.webChannelTransport, function(channel) {
            console.warn(channel.objects.gps.coords);
            var marker = L.marker(channel.objects.gps.coords).addTo(map);
            channel.objects.gps.coordsChanged.connect(function(){
                // console.warn(channel.objects.gps.coords);
                marker.setLatLng(channel.objects.gps.coords);

                });

            });
            var snazzyCircle = L.icon({
                iconUrl: 'snazzyCircle.png',
                iconSize: [25,25],
                iconAnchor: [12.5,12.5],
                popupAnchor: [0,-13]

            });


            function changeText() {
                _wayPointNumber++;
                x = document.getElementById("_lat");
                y = document.getElementById("_long");
                var marker = L.marker([x.value, y.value], {
                    rotationAngle: 60,
                    icon: snazzyCircle
                }).addTo(map);
                marker.bindPopup("Way Point: " + getWayPointNumber() + "</br>Lat: " + x.value + "</br>Long: " + y.value);
            };
            function checkCoordWithClick(e) {
                clickPopup.setLatLng(e.latlng);
                clickPopup.setContent("Click Coord:</br>" + e.latlng.toString());
                clickPopup.openOn(map);

            };
            map.on('click', checkCoordWithClick);

        </script>
        <input type="text" id="_lat" value="38.4063">
        <input type="text" id="_long" value="-110.792286">
        <input type="text" id="_wayPointName" value="">
        <button onClick="changeText()">Add WayPoint</button>
    </body>
</html>
